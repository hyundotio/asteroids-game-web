(()=>{"use strict";var t,i=function(){function t(){this.north=null,this.south=null,this.east=null,this.west=null,this.nextSprite=null,this.visible=!1,this.name="",this.dupe={horizontal:null,vertical:null}}return t.prototype.enter=function(t){t.nextSprite=this.nextSprite,this.nextSprite=t},t.prototype.leave=function(t){for(var i=this;i&&i.nextSprite!==t;)i=i.nextSprite;i&&(i.nextSprite=t.nextSprite,t.nextSprite=null)},t.prototype.eachSprite=function(t,i){for(var e=this;e.nextSprite;)e=e.nextSprite,i.call(t,e)},t.prototype.isEmpty=function(t){for(var i=!0,e=this;e.nextSprite&&(i=!(e=e.nextSprite).visible||-1===t.indexOf(e.name)););return i},t}(),e=function(){function t(t,i){this.rows=t,this.columns=i,this.data=[];for(var e=0;e<t;e++)this.data.push([i])}return t.prototype.configure=function(t,i,e,s){var o=t*Math.PI/180,n=Math.sin(o)*i,r=Math.cos(o)*i;this.set(r,-n,e,n,r,s)},t.prototype.set=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var e=0,s=0;s<this.rows;s++)for(var o=0;o<this.columns;o++)this.data[s][o]=t[e],e++},t.prototype.multiply=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var e=new Array(this.rows),s=0;s<this.rows;s++){e[s]=0;for(var o=0;o<this.columns;o++)e[s]+=this.data[s][o]*t[o]}return e},t}(),s=function(){return s=Object.assign||function(t){for(var i,e=1,s=arguments.length;e<s;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t},s.apply(this,arguments)},o=s({},{shipMissile:"#0066ff",shipOutline:"#7D48ED",explosion:"#EDAB48",exhaust:"#EDAB48",asteroid:"#8F2400",alienShip:"#05A461",alienMissile:"#EA30E8",background:"#F4F4F4",default:"#161616",text:"#161616"}),n=(t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}),r=function(t){function i(i){var s=t.call(this)||this;return s.points=[],s.vel={},s.acc={},s.children={},s.reap=!1,s.bridgesH=!0,s.bridgesV=!0,s.collidesWith=[],s.x=0,s.y=0,s.rot=0,s.scale=1,s.currentNode=null,s.transPoints=null,s.context=null,s.matrix=new e(2,3),s.grid=null,s.spriteColor=i.spriteColor?i.spriteColor:o.default,s.name=i.name,s.points=i.points||[],s.context=i.context,s.grid=i.grid,s.vel={x:0,y:0,rot:0},s.acc={x:0,y:0,rot:0},s.points=s.points.map((function(t){return t*u.dpr})),s}return n(i,t),i.prototype.preMove=function(t){},i.prototype.postMove=function(t){},i.prototype.run=function(t){var i,e,s,o,n,r,h,l;this.move(t),this.updateGrid(),null===(i=this.context)||void 0===i||i.save(),this.configureTransform(),this.draw();var a=this.findCollisionCanidates();this.matrix.configure(this.rot,this.scale,this.x,this.y),this.checkCollisionsAgainst(a),null===(e=this.context)||void 0===e||e.restore(),this.bridgesH&&this.currentNode&&this.currentNode.dupe.horizontal&&(this.x+=this.currentNode.dupe.horizontal,null===(s=this.context)||void 0===s||s.save(),this.configureTransform(),this.draw(),this.checkCollisionsAgainst(a),null===(o=this.context)||void 0===o||o.restore(),this.currentNode&&(this.x-=this.currentNode.dupe.horizontal)),this.bridgesV&&this.currentNode&&this.currentNode.dupe.vertical&&(this.y+=this.currentNode.dupe.vertical,null===(n=this.context)||void 0===n||n.save(),this.configureTransform(),this.draw(),this.checkCollisionsAgainst(a),null===(r=this.context)||void 0===r||r.restore(),this.currentNode&&(this.y-=this.currentNode.dupe.vertical)),this.bridgesH&&this.bridgesV&&this.currentNode&&this.currentNode.dupe.vertical&&this.currentNode.dupe.horizontal&&(this.x+=this.currentNode.dupe.horizontal,this.y+=this.currentNode.dupe.vertical,null===(h=this.context)||void 0===h||h.save(),this.configureTransform(),this.draw(),this.checkCollisionsAgainst(a),null===(l=this.context)||void 0===l||l.restore(),this.currentNode&&(this.x-=this.currentNode.dupe.horizontal,this.y-=this.currentNode.dupe.vertical))},i.prototype.move=function(t){this.visible&&(this.transPoints=null,this.preMove(t),this.vel.x+=this.acc.x*t,this.vel.y+=this.acc.y*t,this.x+=this.vel.x*t,this.y+=this.vel.y*t,this.rot+=this.vel.rot*t,this.rot>360?this.rot-=360:this.rot<0&&(this.rot+=360),this.postMove(t))},i.prototype.updateGrid=function(){var t;if(this.visible&&this.grid){var i=Math.floor(this.x/u.gridSize),e=Math.floor(this.y/u.gridSize);i=i>=this.grid.length?0:i,e=e>=this.grid[0].length?0:e,i=i<0?this.grid.length-1:i,e=e<0?this.grid[0].length-1:e;var s=this.grid[i][e];s!==this.currentNode&&(this.currentNode&&this.currentNode.leave(this),s.enter(this),this.currentNode=s),u.state.KEY_STATUS.g&&this.currentNode&&this.context&&(this.context.lineWidth=3,this.context.strokeStyle="green",null===(t=this.context)||void 0===t||t.strokeRect(i*u.gridSize+2,e*u.gridSize+2,u.gridSize-4,u.gridSize-4),this.context.strokeStyle="black",this.context.lineWidth=1)}},i.prototype.configureTransform=function(){var t,i,e;if(this.visible){var s=this.rot*Math.PI/180;null===(t=this.context)||void 0===t||t.translate(this.x,this.y),null===(i=this.context)||void 0===i||i.rotate(s),null===(e=this.context)||void 0===e||e.scale(this.scale,this.scale)}},i.prototype.draw=function(){if(this.visible&&this.context){for(var t in this.context.lineWidth=1/this.scale*u.dpr,this.children)this.children[t].draw();this.context.beginPath(),this.context.moveTo(this.points[0],this.points[1]);for(var i=1;i<this.points.length/2;i++){var e=2*i,s=e+1;this.context.lineTo(this.points[e],this.points[s])}this.context.strokeStyle=this.spriteColor,this.context.closePath(),this.context.stroke()}},i.prototype.findCollisionCanidates=function(){var t,i,e,s,o,n,r,h,l,a,c,p;if(!this.visible||!this.currentNode)return[];var u=this.currentNode,d=[];return u.nextSprite&&d.push(u.nextSprite),(null===(t=u.north)||void 0===t?void 0:t.nextSprite)&&d.push(u.north.nextSprite),(null===(i=u.south)||void 0===i?void 0:i.nextSprite)&&d.push(u.south.nextSprite),(null===(e=u.east)||void 0===e?void 0:e.nextSprite)&&d.push(u.east.nextSprite),(null===(s=u.west)||void 0===s?void 0:s.nextSprite)&&d.push(u.west.nextSprite),(null===(n=null===(o=u.north)||void 0===o?void 0:o.east)||void 0===n?void 0:n.nextSprite)&&d.push(u.north.east.nextSprite),(null===(h=null===(r=u.north)||void 0===r?void 0:r.west)||void 0===h?void 0:h.nextSprite)&&d.push(u.north.west.nextSprite),(null===(a=null===(l=u.south)||void 0===l?void 0:l.east)||void 0===a?void 0:a.nextSprite)&&d.push(u.south.east.nextSprite),(null===(p=null===(c=u.south)||void 0===c?void 0:c.west)||void 0===p?void 0:p.nextSprite)&&d.push(u.south.west.nextSprite),d},i.prototype.checkCollisionsAgainst=function(t){for(var i=0;i<t.length;i++){var e=t[i];do{this.checkCollision(e),e=e.nextSprite}while(e)}},i.prototype.checkCollision=function(t){var i;if(t.visible&&this!==t&&-1!==this.collidesWith.indexOf(t.name))for(var e=t.transformedPoints(),s=e.length/2,o=0;o<s;o++){var n=e[2*o],r=e[2*o+1];if(u.isFirefox?this.pointInPolygon(n,r):null===(i=this.context)||void 0===i?void 0:i.isPointInPath(n,r))return t.collision(this),void this.collision(t)}},i.prototype.collision=function(t){throw Error("collision not implemented")},i.prototype.pointInPolygon=function(t,i){for(var e,s,o=this.transformedPoints(),n=2,r=!1,h=0;h<o.length;h+=2)e=o[h+1],s=o[n+1],(e<i&&s>=i||s<i&&e>=i)&&o[h]+(i-e)/(s-e)*(o[n]-o[h])<t&&(r=!r),(n+=2)===o.length&&(n=0);return r},i.prototype.die=function(){this.visible=!1,this.reap=!0,this.currentNode&&(this.currentNode.leave(this),this.currentNode=null)},i.prototype.transformedPoints=function(){if(this.transPoints)return this.transPoints;var t=new Array(this.points.length);this.matrix.configure(this.rot,this.scale,this.x,this.y);for(var i=0;i<this.points.length/2;i++){var e=2*i,s=e+1,o=this.matrix.multiply(this.points[e],this.points[s],1);t[e]=o[0],t[s]=o[1]}return this.transPoints=t,t},i.prototype.isClear=function(){var t,i,e,s,o,n,r,h,l,a,c,p;if(0===this.collidesWith.length||!this.grid)return!0;var d=this.currentNode;if(null===d){var v=Math.floor(this.x/u.gridSize),f=Math.floor(this.y/u.gridSize);v=v>=this.grid.length?0:v,f=f>=this.grid[0].length?0:f,d=this.grid[v][f]}return d.isEmpty(this.collidesWith)&&(null===(t=d.north)||void 0===t?void 0:t.isEmpty(this.collidesWith))&&(null===(i=d.south)||void 0===i?void 0:i.isEmpty(this.collidesWith))&&(null===(e=d.east)||void 0===e?void 0:e.isEmpty(this.collidesWith))&&(null===(s=d.west)||void 0===s?void 0:s.isEmpty(this.collidesWith))&&(null===(n=null===(o=d.north)||void 0===o?void 0:o.east)||void 0===n?void 0:n.isEmpty(this.collidesWith))&&(null===(h=null===(r=d.north)||void 0===r?void 0:r.west)||void 0===h?void 0:h.isEmpty(this.collidesWith))&&(null===(a=null===(l=d.south)||void 0===l?void 0:l.east)||void 0===a?void 0:a.isEmpty(this.collidesWith))&&(null===(p=null===(c=d.south)||void 0===c?void 0:c.west)||void 0===p?void 0:p.isEmpty(this.collidesWith))},i.prototype.wrapPostMove=function(){this.x>u.canvasWidth?this.x=0:this.x<0&&(this.x=u.canvasWidth),this.y>u.canvasHeight?this.y=0:this.y<0&&(this.y=u.canvasHeight)},i}(i),h=function(){var t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),l=function(t){function i(i,e){var s=t.call(this,{spriteColor:o.asteroid,name:"asteroid",context:i,grid:e,points:[-10,0,-5,7,-3,4,1,10,5,4,10,0,5,-6,2,-10,-4,-10,-4,-5]})||this;return s.visible=!0,s.scale=6,s.postMove=s.wrapPostMove,s.collidesWith=["ship","missile","alienship","alienmissile"],s}return h(i,t),i.prototype.preMove=function(){},i.prototype.collision=function(t){var e;"missile"===t.name&&(u.score+=120/this.scale);for(var s=0;s<3;s++){var o=new i(this.context,this.grid);o.x=this.x,o.y=this.y,o.scale=this.scale/3,o.scale>.5&&(o.vel.x=6*Math.random()-3,o.vel.y=6*Math.random()-3,Math.random()>.5&&(null===(e=o.points)||void 0===e||e.reverse()),o.vel.rot=2*Math.random()-1,o.move(3*o.scale),u.sprites.push(o))}u.explosionAt(t.x,t.y),this.die()},i}(r),a=function(){var t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),c=function(t){function i(i,e){var s=t.call(this,{spriteColor:o.explosion,name:"explosion",context:i,grid:e})||this;s.lines=[],s.bridgesH=!1,s.bridgesV=!1,s.lines=[];for(var n=0;n<5;n++){var r=2*Math.PI*Math.random(),h=Math.cos(r)*u.dpr,l=Math.sin(r)*u.dpr;s.lines.push([h,l,2*h,2*l])}return s}return a(i,t),i.prototype.draw=function(){if(this.visible&&this.context){this.context.save(),this.context.lineWidth=1/this.scale*u.dpr,this.context.beginPath(),this.context.strokeStyle=o.explosion;for(var t=0;t<5;t++){var i=this.lines[t];this.context.moveTo(i[0],i[1]),this.context.lineTo(i[2],i[3])}this.context.stroke(),this.context.restore()}},i.prototype.preMove=function(t){this.visible&&(this.scale+=t),this.scale>8&&this.die()},i}(r),p=function(){function t(){this.context=null,this.face={glyphs:{},resolution:0,boundingBox:{xMin:0,xMax:0,yMin:0,yMax:0}}}return t.prototype.renderGlyph=function(t){var i=this.face.glyphs[t];if(i.o&&this.context){var e=void 0;i.cached_outline?e=i.cached_outline:(e=i.o.split(" "),i.cached_outline=e);for(var s=e.length,o=0;o<s;)switch(e[o++]){default:break;case"m":this.context.moveTo(e[o++],e[o++]);break;case"l":this.context.lineTo(e[o++],e[o++]);break;case"q":var n=e[o++],r=e[o++];this.context.quadraticCurveTo(e[o++],e[o++],n,r);break;case"b":var h=e[o++],l=e[o++];this.context.bezierCurveTo(e[o++],e[o++],e[o++],e[o++],h,l)}}i.ha&&this.context&&this.context.translate(i.ha,0)},t.prototype.renderText=function(t){if(this.context){this.context.save();var i=t.text.split(""),e=i.length,s=void 0;if(t.dpr?(t.x=t.x*t.dpr,t.y=t.y*t.dpr,s=t.size*(72*t.dpr)/(100*this.face.resolution)):s=72*t.size/(100*this.face.resolution),t.xCenterVal){var o=(this.face.boundingBox.xMax-this.face.boundingBox.xMin)/(this.face.boundingBox.yMax-this.face.boundingBox.yMin),n=o*t.size/6,r=(t.size*o*e+e*n)*(t.dpr?t.dpr:1);t.x=(t.xCenterVal-r)/2}t.yCenterVal&&(t.y=t.yCenterVal/2+t.size*(t.dpr?t.dpr:1)/2),this.context.translate(t.x,t.y),this.context.scale(s,-s),this.context.beginPath();for(var h=0;h<e;h++)this.renderGlyph(i[h]);this.context.fillStyle=t.color?t.color:"#161616",this.context.fill(),this.context.restore()}},t}(),u=new(function(){function t(){this.context=null,this.gameText=new p,this.score=0,this.totalAsteroids=5,this.lives=0,this.timer=null,this.grid=null,this.gridHeight=0,this.gridWidth=0,this.lastFrame=0,this.canvasWidth=800,this.canvasHeight=600,this.renderWidth=800,this.renderHeight=600,this.dpr=1,this.gridSize=60,this.isFirefox=navigator.userAgent.indexOf("Firefox")>0,this.sprites=[],this.ship=null,this.extraShip=null,this.AlienShip=null,this.nextAlienShipTime=1/0,this.state={KEY_STATUS:{space:!1," ":!1,arrowleft:!1,arrowup:!1,arrowright:!1,arrowdown:!1,f:!1,g:!1,h:!1,m:!1,p:!1},isPaused:!1,isRunning:!0},this.innerState="boot"}return t.prototype.spawnAsteroids=function(t){var i;t||(t=this.totalAsteroids);for(var e=0;e<t;e++){var s=new l(this.context,this.grid);for(s.x=Math.random()*this.canvasWidth,s.y=Math.random()*this.canvasHeight;!s.isClear();)s.x=Math.random()*this.canvasWidth,s.y=Math.random()*this.canvasHeight;s.vel.x=4*Math.random()-2,s.vel.y=4*Math.random()-2,Math.random()>.5&&(null===(i=s.points)||void 0===i||i.reverse()),s.vel.rot=2*Math.random()-1,this.sprites.push(s)}},t.prototype.explosionAt=function(t,i){var e=new c(this.context,this.grid);e.x=t,e.y=i,e.visible=!0,this.sprites.push(e)},t.prototype.boot=function(){this.spawnAsteroids(5),this.innerState="waiting"},t.prototype.waiting=function(){u.gameText.renderText({text:"PRESS SPACE TO START",size:24,x:0,y:0,color:o.text,dpr:this.dpr,xCenterVal:u.canvasWidth,yCenterVal:u.canvasHeight}),this.state.KEY_STATUS.space&&(this.state.KEY_STATUS.space=!1,this.innerState="start")},t.prototype.reset=function(){this.lives=0,this.score=0,this.score=0,this.totalAsteroids=5,this.lives=0,this.sprites=[],this.ship=null,this.AlienShip=null,this.nextAlienShipTime=1/0,this.innerState="boot"},t.prototype.start=function(){for(var t=0;t<this.sprites.length;t++)"asteroid"===this.sprites[t].name?this.sprites[t].die():"missile"!==this.sprites[t].name&&"AlienShip"!==this.sprites[t].name||(this.sprites[t].visible=!1);this.score=0,this.lives=2,this.totalAsteroids=2,this.spawnAsteroids(),this.nextAlienShipTime=Date.now()+3e4+3e4*Math.random(),this.innerState="spawn_ship"},t.prototype.spawn_ship=function(){this.ship&&(this.ship.x=this.canvasWidth/2,this.ship.y=this.canvasHeight/2,this.ship.isClear()&&(this.ship.rot=0,this.ship.vel.x=0,this.ship.vel.y=0,this.ship.visible=!0,this.innerState="run"))},t.prototype.run=function(){for(var t,i=!0,e=0;e<this.sprites.length;e++)if("asteroid"===this.sprites[e].name){i=!1;break}i&&(this.innerState="new_level"),this.AlienShip&&!(null===(t=this.AlienShip)||void 0===t?void 0:t.visible)&&Date.now()>this.nextAlienShipTime&&(this.AlienShip.visible=!0,this.nextAlienShipTime=Date.now()+3e4*Math.random())},t.prototype.new_level=function(){null!==this.timer&&void 0!==this.timer||(this.timer=Date.now()),Date.now()-this.timer>1e3&&(this.timer=null,this.totalAsteroids++,this.totalAsteroids>12&&(this.totalAsteroids=12),this.spawnAsteroids(),this.innerState="run")},t.prototype.player_died=function(){this.lives<0?this.innerState="end_game":(null!==this.timer&&void 0!==this.timer||(this.timer=Date.now()),Date.now()-this.timer>1e3&&(this.timer=null,this.innerState="spawn_ship"))},t.prototype.end_game=function(){u.gameText.renderText({text:"GAME OVER",size:50,x:0,y:0,color:o.text,dpr:this.dpr,xCenterVal:u.canvasWidth,yCenterVal:u.canvasHeight}),null!==this.timer&&void 0!==this.timer||(this.timer=Date.now()),Date.now()-this.timer>5e3&&(this.timer=null,this.innerState="waiting")},t.prototype.execute=function(){this[this.innerState]()},t}()),d=function(){var t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),v=function(t){function i(i,e,s,n){void 0===i&&(i="missile"),void 0===n&&(n=[0,0]);var r=t.call(this,{spriteColor:o.shipMissile,name:i,context:e,grid:s,points:n})||this;return r.time=0,r.bridgesH=!1,r.bridgesV=!1,r.postMove=r.wrapPostMove,r}return d(i,t),i.prototype.configureTransform=function(){},i.prototype.draw=function(){if(this.visible&&this.context){var t=1*u.dpr,i=1*u.dpr,e=3*u.dpr;this.context.save(),this.context.lineWidth=e,this.context.strokeStyle=o.shipMissile,this.context.beginPath(),this.context.moveTo(this.x-t,this.y-i),this.context.lineTo(this.x+t,this.y+i),this.context.moveTo(this.x+t,this.y-i),this.context.lineTo(this.x-t,this.y+i),this.context.stroke(),this.context.restore()}},i.prototype.preMove=function(t){this.visible&&(this.time+=t),this.time>50&&(this.visible=!1,this.time=0)},i.prototype.collision=function(){var t;this.time=0,this.visible=!1,null===(t=this.currentNode)||void 0===t||t.leave(this),this.currentNode=null},i.prototype.transformedPoints=function(){return[this.x,this.y]},i}(r),f=function(){var t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}(),x=(function(t){function i(i,e,s,n){var h=t.call(this,{spriteColor:i,name:"ship",context:s,grid:n,points:[-5,4,0,-12,5,4]})||this;return h.missiles=[],h.collidesWith=["asteroid","alienship","alienmissile"],h.missileCounter=0,h.postMove=h.wrapPostMove,e&&(h.children={exhaust:new r({spriteColor:o.exhaust,name:"exhaust",context:s,grid:n,points:[-3,6,0,11,3,6]})}),h}f(i,t),i.prototype.preMove=function(t){if(u.state.KEY_STATUS.arrowleft?this.vel.rot=-6:u.state.KEY_STATUS.arrowright?this.vel.rot=6:this.vel.rot=0,u.state.KEY_STATUS.arrowup){var i=(this.rot-90)*Math.PI/180;this.acc.x=.5*Math.cos(i),this.acc.y=.5*Math.sin(i),this.children.exhaust.visible=Math.random()>.1}else this.acc.x=0,this.acc.y=0,this.children.exhaust.visible=!1;if(this.missileCounter>0&&(this.missileCounter-=t),u.state.KEY_STATUS.space&&this.missileCounter<=0){this.missileCounter=10;for(var e=0;e<this.missiles.length;e++)if(!this.missiles[e].visible){var s=this.missiles[e],o=(i=(this.rot-90)*Math.PI/180,Math.cos(i)),n=Math.sin(i);s.x=this.x+o*(4*u.dpr),s.y=this.y+n*(4*u.dpr),s.vel.x=6*u.dpr*o+this.vel.x,s.vel.y=6*u.dpr*n+this.vel.y,s.visible=!0;break}}Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y)>8&&(this.vel.x*=.95,this.vel.y*=.95)},i.prototype.collision=function(t){var i;u.explosionAt(t.x,t.y),u.innerState="player_died",this.visible=!1,null===(i=this.currentNode)||void 0===i||i.leave(this),this.currentNode=null,u.lives--}}(r),function(){var t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}()),y=function(t){function i(i,e){return t.call(this,"alienmissile",i,e)||this}return x(i,t),i.prototype.draw=function(){if(this.visible&&this.context){var t=2*u.dpr;this.context.save(),this.context.lineWidth=t,this.context.strokeStyle=o.alienMissile,this.context.beginPath(),this.context.moveTo(this.x,this.y),this.context.lineTo(this.x-this.vel.x,this.y-this.vel.y),this.context.stroke(),this.context.restore()}},i}(v),m=function(){var t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}();!function(t){function i(i,e){var s=t.call(this,{spriteColor:o.alienShip,name:"alienship",context:i,grid:e,points:[-20,0,-12,-4,12,-4,20,0,12,4,-12,4,-20,0,20,0]})||this;return s.collidesWith=["asteroid","ship","missile"],s.bridgesH=!1,s.missiles=[],s.missileCounter=0,s.children={top:new r({spriteColor:o.alienShip,name:"alienship_top",context:s.context,grid:s.grid,points:[-8,-4,-6,-6,6,-6,8,-4]}),bottom:new r({spriteColor:o.alienShip,name:"alienship_bottom",context:s.context,grid:s.grid,points:[8,4,6,6,-6,6,-8,4]})},s.children.top.visible=!0,s.children.bottom.visible=!0,s}m(i,t),i.prototype.newPosition=function(){Math.random()<.5?(this.x=-20,this.vel.x=1.5):(this.x=u.canvasWidth+20,this.vel.x=-1.5),this.y=Math.random()*u.canvasHeight},i.prototype.setup=function(){this.newPosition();for(var t=0;t<3;t++){var i=new y(this.context,this.grid);this.missiles.push(i),u.sprites.push(i)}},i.prototype.preMove=function(t){var i,e,s,o,n,r,h,l,a,c,p=this.currentNode;if(null!==p){var u=0;(null===(i=p.north)||void 0===i?void 0:i.nextSprite)&&u++,(null===(s=null===(e=p.north)||void 0===e?void 0:e.east)||void 0===s?void 0:s.nextSprite)&&u++,(null===(n=null===(o=p.north)||void 0===o?void 0:o.west)||void 0===n?void 0:n.nextSprite)&&u++;var d=0;if((null===(r=p.south)||void 0===r?void 0:r.nextSprite)&&d++,(null===(l=null===(h=p.south)||void 0===h?void 0:h.east)||void 0===l?void 0:l.nextSprite)&&d++,(null===(c=null===(a=p.south)||void 0===a?void 0:a.west)||void 0===c?void 0:c.nextSprite)&&d++,u>d?this.vel.y=1:u<d?this.vel.y=-1:Math.random()<.01&&(this.vel.y=-this.vel.y),this.missileCounter-=t,this.missileCounter<=0){this.missileCounter=22;for(var v=0;v<this.missiles.length;v++)if(!this.missiles[v].visible){var f=this.missiles[v],x=2*Math.PI*Math.random(),y=Math.cos(x),m=Math.sin(x);f.x=this.x,f.y=this.y,f.vel.x=6*y,f.vel.y=6*m,f.visible=!0;break}}}},i.prototype.collision=function(t){"missile"===t.name&&(u.score+=200),u.explosionAt(t.x,t.y),this.visible=!1,this.newPosition()},i.prototype.postMove=function(){this.y>u.canvasHeight?this.y=0:this.y<0&&(this.y=u.canvasHeight),(this.vel.x>0&&this.x>u.canvasWidth+20||this.vel.x<0&&this.x<-20)&&(this.visible=!1,this.newPosition())}}(r)})();